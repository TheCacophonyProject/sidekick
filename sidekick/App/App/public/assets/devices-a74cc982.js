import{I as j,d as K,R as J,a as g,b as O,e as x,f as A,i as o,c,F as Q,g as X,t as S,h as F,j as Y,k as Z,B as ee,l as N,m as te,n as ie,p as ne,q as se,o as oe,G as ce,r as ae}from"./index-f88eeaa7.js";import{A as le}from"./ActionContainer-3cd0ceda.js";import{D as R}from"./index-f1e8cfe7.js";import{C as re}from"./CircleButton-5d610d1b.js";import{I as de}from"./index-cb72b98b.js";function ve(e){return j({a:{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24"},c:'<path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="3"/><circle cx="12" cy="12" r="8"/><path d="M12 2v2M12 20v2M20 12h2M2 12h2"/>'},e)}function ue(e){return j({a:{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",viewBox:"0 0 24 24"},c:'<path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>'},e)}const fe=S('<div class="flex items-center justify-between px-2"><div role="button"><h1 class="break-all text-left text-lg"></h1><div class="mt-2 flex w-full items-center space-x-2 text-slate-700"><p class="text-sm">Recordings Saved: <!>/<!> </p></div><div class="mt-2 flex w-full items-center space-x-2 text-slate-700"><p class="text-sm">Events Saved: <!>/<!> </p></div></div><div class="flex items-center space-x-6 px-2"><button></button><button class="text-blue-500"></button></div></div>',24),ge=S('<button class="text-blue-500"></button>',2),he=S('<div class="text-yellow-400"></div>',2),me=S('<section class="pb-bar pt-bar relative h-full space-y-2 overflow-y-auto bg-gray-200 px-2"><div class="h-32 bg-gray-200"></div><div class="pb-bar fixed inset-x-0 bottom-[4vh] mx-auto flex justify-center"></div></section>',6);function xe(e){const a=K(),[d,w]=g([]),[h,C]=g([]),[y,r]=g([]),[i,f]=g([]),[n,v]=g(!1);x(()=>{const t=h().length>0||h().length!==d().length,s=i().length>0||y().length!==i().length;v(!t&&!s)}),x(()=>{const t=F().filter(u=>u.device===e.device.id&&!u.isUploaded),s=[...a.deviceEventKeys.get(e.device.id)??[]];r(t),f(s)}),x(()=>{const t=Y().filter(u=>u.device===e.device.id&&!u.isUploaded),s=[...a.deviceRecordings.get(e.device.id)??[]];w(t),C(s)});const b=t=>{t.isConnected&&ae.open({url:t.url})},D=async t=>{const{value:s}=await R.confirm({title:"Confirm",message:`Are you sure you want to set device ${t.name} to your current location?`});s&&t.isConnected&&await a?.setDeviceToCurrLocation(t)},H=async t=>{const{value:s}=await R.confirm({title:"Confirm",message:`Are you sure you want to download all recordings and events from ${t.name}?`});s&&t.isConnected&&(a.saveRecordings(t),a.saveEvents(t))};return c(le,{get action(){return(()=>{const t=ge.cloneNode(!0);return t.$$click=()=>b(e.device),o(t,c(Z,{size:32})),t})()},get children(){const t=fe.cloneNode(!0),s=t.firstChild,u=s.firstChild,k=u.nextSibling,$=k.firstChild,P=$.firstChild,L=P.nextSibling,G=L.nextSibling,E=G.nextSibling;E.nextSibling;const M=k.nextSibling,_=M.firstChild,V=_.firstChild,B=V.nextSibling,q=B.nextSibling,T=q.nextSibling;T.nextSibling;const W=s.nextSibling,m=W.firstChild,p=m.nextSibling;return s.$$click=()=>b(e.device),o(u,()=>e.device.name),o(k,c(ee,{size:20}),$),o($,()=>d().length,L),o($,()=>h().length,E),o(M,c(de,{size:20}),_),o(_,()=>F().filter(l=>l.device===e.device.id).length,B),o(_,()=>a.deviceEventKeys.get(e.device.id)?.length??0,T),m.$$click=()=>H(e.device),o(m,c(ue,{size:28})),p.$$click=()=>D(e.device),o(p,c(N,{get when(){return!a.locationBeingSet.has(e.device.id)},get fallback(){return c(te,{size:28,class:"animate-spin"})},get children(){return c(N,{get when(){return!e.shouldUpdateLocation},get fallback(){return(()=>{const l=he.cloneNode(!0);return o(l,c(ve,{size:28})),l})()},get children(){return c(ie,{size:28})}})}})),ne(l=>{const U=`${n()?"text-slate-300":"text-blue-500"}`,z=n(),I=a.locationBeingSet.has(e.device.id);return U!==l._v$&&se(m,l._v$=U),z!==l._v$2&&(m.disabled=l._v$2=z),I!==l._v$3&&(p.disabled=l._v$3=I),l},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t}})}function Ce(){const e=K(),a=()=>{e.startDiscovery(),setTimeout(()=>{e.stopDiscovery()},5e3)},d=new J,[w,h]=g(),[C,y]=g(!1);return O(async()=>{a();const r=setInterval(()=>{a()},60*1e3*1);oe(()=>{clearInterval(r)}),h(await ce.getCurrentPosition({enableHighAccuracy:!0}))}),x(()=>{const r=e.devices.values();A(async()=>{for(const i of r){if(!i.isConnected)return;const f=await e.getLocation(i);if(f.success){const n=f.data,v=w();if(!v)return d.delete(i.id);const b=Math.abs(n.latitude-v.coords.latitude),D=Math.abs(n.longitude-v.coords.longitude);b>.001||D>.001?d.add(i.id):d.delete(i.id)}}})}),x(()=>{if(e.isDiscovering())return;const i=d.values();A(async()=>{if([...i].filter(n=>!e.locationBeingSet.has(n)).length>0&&!C()){const{value:n}=await R.confirm({title:"Update Locations",message:"Some devices are not at your current location. Would you like to update their locations?"});if(n)for(const v of e.devices.values())d.has(v.id)&&v.isConnected&&await e.setDeviceToCurrLocation(v);else y(!0)}}),e.isDiscovering()}),(()=>{const r=me.cloneNode(!0),i=r.firstChild,f=i.nextSibling;return o(r,c(Q,{get each(){return[...e.devices.values()]},children:n=>n&&c(xe,{device:n,get shouldUpdateLocation(){return d.has(n.id)}})}),i),o(f,c(re,{onClick:a,get disabled(){return e?.isDiscovering()},get loading(){return e?.isDiscovering()},text:"Search Devices",loadingText:"Searching..."})),r})()}X(["click"]);export{Ce as default};
